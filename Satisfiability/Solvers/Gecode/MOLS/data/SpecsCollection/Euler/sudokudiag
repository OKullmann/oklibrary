# Counts for N >= 2:
# 0, 0, 2, 2, 0, 18, >= 587, >= 2193, ?


# By [Keedwell, 2011] for all prime powers b (the box-size; so N = b^2)
# "complete" orthogonal sets of diagonal Sudoku squares for box-size b exist,
# that is, the maximal number b^2 - b of possible MODSLS.
# So for N=9 we have 6-MODSLS, for N=16 there are 12-MODSLS, and for
# N=25 there are 20-MODSLS.

# Thus for all square N the problems here are satisfiable.

# Is N=10 unsatisfiable?

# SelfOrthogonalSudokudiag is a special case (a square is Sudoko iff
# the transposed is, and a square is diagonal iff the transposed is).


# gcMols:

# N=7: best regarding flvs (for counting) is dom+bin+mindom.
# MOLS> time ./gcMols 7 data/SpecsCollection/Euler/sudokudiag "" +count "" bin mindom asc 1 16 ""
#  N       rt  pl  bt        bv   bo gcd      satc           t           ppc        flvs        gnds     gd st
#  7   +count dom bin    mindom  asc   1        18      14.830      27426948      203948      407931     25  0
# real	0m1.591s user	0m8.416s sys	0m0.218s
# N=8: best for finding solutions appears dom+bin+mindom+desc.
# ./gcMols 9 data/SpecsCollection/EulerSudokudiag "" +count "" bin mindom desc 1 12 t,180
#   N       rt  pl  bt        bv   bo  gcd        satc           t           ppc        flvs        gnds     gd st
#   9   +count dom bin    mindom desc    1          48    1958.242    3282264744    18582584    37165428     43  1
# A second run found 587 solutions.
# Seems very similar to enu.
# N=9: far best for finding solutions appears dom+enu+mindom+asc (but that might
# actually be chance):
# MOLS> ./gcMols 9 data/SpecsCollection/EulerSudokudiag "" +count "" enu mindom asc 1 12 t,180
#   N       rt  pl  bt        bv   bo  gcd        satc           t           ppc        flvs        gnds     gd st
#   9   +count dom enu    mindom  asc    1        2193    1947.976    3161705464    18436732    35218171     42  1
# N=10 (satisfiability unknown):
# MOLS> ./gcMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu mindom asc 1 12 t,180
#   N       rt  pl  bt        bv   bo  gcd        satc           t           ppc        flvs        gnds     gd st
#  10   +count dom enu    mindom  asc    1           0    1837.008    3115914845    16618531    32792338     62  1
# MOLS> ./gcMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" - mindom - 1 12 t,180
# also no solution found.


# rlaMols:

# MOLS> time ./rlaMols 7 data/SpecsCollection/Euler/sudokudiag "" +count "" enu mindom asc "" 1 16 ""
#  N       rt  pl  bt        bv   bo    lar gcd     satc           t        ppc st      nds    inds      lvs
#  7   +count dom enu    mindom  asc  relpr   1       18     271.764     314643  0     5265    2416     2849
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#467.210  0.938   11.082  123.535  204.761   2.239  0.000  0.778    1.615   6.605
#373.000  0.000    0.278   61.972   96.404   1.000  0.000  0.100    0.000   0.000
#596.000  2.000   39.344  129.082  748.869   7.000  0.000  4.197   37.010  11.000
# 29.617  0.384    5.404    2.648   80.963   0.848  0.000  0.456    2.014   1.353
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#421.393  1.599   10.883   25.531   99.791   1.524  0.006  0.404   10.908   8.317
#120.000  1.097    0.000    0.000    0.568   1.000  0.000  0.000    0.568   5.000
#507.000  5.000  300.000  121.142  796.119   9.000  1.000  3.762   27.897  12.000
# 35.665  0.310   14.729   19.916  104.127   0.907  0.079  0.473    5.368   0.903
# real    0m27.332s user    4m31.773s sys     0m27.402s
# MOLS> time ./rlaMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu mindom asc "" 1 12
# aborted after 4min wallclock-time without finding a solution.


# laMols with wdL:

# MOLS> time ./laMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu dL asc "" 1 12 ""
# aborted after 3min wallclock-time without finding a solution.

# MOLS> time ./laMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu wdL asc "" 1 12 ""
# aborted after 3min wallclock-time without finding a solution.

# TASK OZ: Using nomad+TAUscan for finding weights for N=6,7,8,9,10.

# N=6:

# Optimising TAUscan on ave via Nomad (MAX_TIME 600s, rep=100):
# TAU_sudokudiag_6_wdL_ave> nomad np
# 753   5.041725   2.739548   2.732939   1.645779   0.61019
# Blackbox evaluations: 987 Total model evaluations: 87726 Cache hits: 335 Total number of evaluations: 1322
# Reproduction:
# time ./TAUscan 6 ../sudokudiag "" wdL hash "2.739548,2.732939,1.645779,0.61019" 100 1 all
# 100 : 3.62115027366100835802e+00 6.38989216433905085017e+00 1.90530866400931112037e+01; 4.94551465328500400049e+00
# real    0m5.354s user    0m4.964s sys     0m0.396s

# Alternative optimisation on ave+sd (MAX_TIME 600s, rep=100):
# 859   7.412977   4.071902   6.134798   1.085      7.0
# Blackbox evaluations: 969 Total model evaluations: 90004 Cache hits: 359 Total number of evaluations: 1328
# Reproduction:
# time ./TAUscan 6 ../sudokudiag "" wdL hash "4.071902,6.134798,1.085,7.0" 100 1 all
# 100 : 4.09219811198067823016e+00 5.52539513510423356546e+00 1.16632512390651822617e+01; 2.88393057263846043308e+00
# real    0m4.562s user    0m4.271s sys     0m0.281s
# Failure in reproduction

# N=7:

# Optimising TAUscan via Nomad (MAX_TIME 10000s, rep=100):
# TAU_sudokudiag_7_wdL_ave> nomad np
# 554 1035.026673   0.896981   5.237416   0.934715   0.0001     7
# Blackbox evaluations: 1184 Cache hits: 413 Total number of evaluations: 1597
# Reproduction:
# TAU_sudokudiag_7_wdL_ave> time ./TAUscan 7 ../sudokudiag "" wdL hash "0.896981,5.237416,0.934715,0.0001,7" 100 10 all
# 100 : 2.41166889536214376619e+02 1.31864563519242289147e+03 5.98068703983010299652e+03; 1.05679070384081706568e+03
# real    0m4.536s user    0m39.282s sys     0m0.398s
# Failure in reproduction.
# TAU_sudokudiag_7_wdL_ave> time ./laMols 7 ../sudokudiag "" +count dom enu wdL "" "" 1 16 "0.896981,5.237416,0.934715,0.0001,7" "" ""
#  N       rt  pl lbt  dis   lbo    lar gcd     satc           t        ppc st      nds    inds      lvs     plvs
#  7   +count dom enu  wdL   asc  relpr   1       18     160.159     213898  0     2282     908     1374        0
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals     dp
#472.244  1.054   15.136  122.972  203.645   2.327  0.000  0.870    1.955  5.522
#380.000  0.000    0.278   65.509  101.786   1.000  0.000  0.130    0.000  0.000
#596.000  2.000   61.124  128.141  627.594   7.000  0.000  3.142   28.158  9.000
# 31.122  0.274    6.654    3.150   70.938   0.750  0.000  0.388    2.213  1.356
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#397.857  1.676   20.803   22.467   80.691   1.339  0.013  0.366   10.688   7.103
#126.000  1.100    0.000    0.000    0.494   1.000  0.000  0.000    0.494   5.000
#498.000  4.000  300.000  115.777  649.672   7.000  1.000  3.237   26.305  10.000
# 46.647  0.365   23.563   15.261   87.851   0.754  0.114  0.428    5.284   1.082
#     estlvs
#   6942.910
#    198.271
#4173816.236
# 114603.512
#      mu1      w   ltau   minp  meanp   maxp    sdd     tb
#11667.980  2.512  0.001  0.298  0.418  0.559  0.121  0.535
#  977.000  2.000  0.000  0.001  0.250  0.265  0.000  0.103
#16664.000  4.000  0.002  0.500  0.500  0.929  0.429  0.837
# 1454.889  0.578  0.000  0.137  0.088  0.125  0.096  0.127
# real    0m14.812s user    2m40.164s sys     0m15.770s
# The number of leaves and the runtime is about 2 times better than on rlaMols.

# Alternative optimisation on ave+sd (MAX_TIME 10000s, rep=100):
# TAU_sudokudiag_7_wdL_avepsd> nomad np
# 585  1814.964923   4.089999   6.999999   0.110002   0.0001     4.999999
# Blackbox evaluations: 1087 Total model evaluations: 99237 Cache hits: 375 Total number of evaluations: 1462
# Reproduction:
# TAU_sudokudiag_7_wdL_ave> time ./TAUscan 7 ../sudokudiag "" wdL hash "4.089999,6.999999,0.110002,0.0001,4.999999" 100 10 all
# 100 : 3.60482152037264433508e+02 1.70786660062998327003e+03 1.64301985317896331011e+04; 2.07220955349689412128e+03
# real    0m4.097s user    0m38.522s sys     0m0.420s
# Failure in reproduction.
# TAU_sudokudiag_7_wdL_ave> time ./laMols 7 ../sudokudiag "" +count dom enu wdL "" "" 1 16 "4.089999,6.999999,0.110002,0.0001,4.999999" "" ""
#  N       rt  pl lbt  dis   lbo    lar gcd     satc           t        ppc st      nds    inds      lvs     plvs
#  7   +count dom enu  wdL   asc  relpr   1       18     136.166     252064  0     2647     993     1654        0
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#475.955  1.043   14.410  122.606  208.370   2.382  0.000  0.389    2.196   5.515
#368.000  0.000    0.278   58.407   97.375   1.000  0.000  0.033    0.000   0.000
#596.000  2.000   40.309  128.643  626.380   7.000  0.000  2.424   36.062  10.000
# 32.501  0.290    6.521    3.444   73.389   0.782  0.000  0.352    2.510   1.366
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#403.401  1.676   19.785   22.008   80.018   1.362  0.011  0.148   10.406   7.004
#126.000  1.100    0.000    0.000    0.478   1.000  0.000  0.000    0.478   5.000
#505.000  4.000  300.000  118.126  629.724   7.000  1.000  2.470   26.180  11.000
# 45.954  0.369   23.477   16.447   92.761   0.800  0.104  0.240    5.625   1.119
#     estlvs
#  12919.336
#    180.066
#6392864.202
# 161691.578
#       mu1      w   ltau   minp  meanp   maxp    sdd     tb
#225677.591  2.665  0.000  0.263  0.398  0.552  0.131  0.235
# 27384.000  2.000  0.000  0.001  0.167  0.256  0.000  0.039
#295744.000  6.000  0.000  0.500  0.500  0.967  0.467  0.744
# 22150.427  0.672  0.000  0.135  0.093  0.138  0.096  0.183
# real    0m28.970s user    2m16.175s sys     0m2.832s
# Runtime-wise about 10 % better than ave, but leaves-wise about 20 % worse tha ave.

# Alternative optimisation on sd (MAX_TIME 10000s, rep=100):
# XXX running on server

# Alternative optimisation on max (MAX_TIME 10000s, rep=100):
# XXX running on server

# N=8:

# Optimising TAUscan via Nomad (MAX_TIME 72000s, rep=1000):
# TAU_sudokudiag_8_wdL_ave> nomad np
# 845 2327725518.448992   0.0011     3.717205   0.7554     0.0001     0.000103   0.0079
# Blackbox evaluations: 1134 Cache hits: 420 Total number of evaluations: 1554
# Reproduction:
# time ./TAUscan 8 ../sudokudiag "" wdL hash "0.0011,3.717205,0.7554,0.0001,0.000103,0.0079" 1000 10 all
# 1000 : 3.80687517248157153858e+06 2.80377110592548625590e+09 2.24546272654005594388e+11; 9.86473193100444523990e+09
# real    2m32.250s user    25m2.382s
# Failure in reproduction.

# Alternative optimisation on ave+sd (MAX_TIME 72000s, rep=1000):
# TAU_sudokudiag_8_wdL_avepsd> nomad np
# 296  5232343721.306151   5.72       1.13       0.36       0.0001     0.02       1.1
# Blackbox evaluations: 1181 Total model evaluations: 91787 Cache hits: 409 Total number of evaluations: 1590
# Reproduction:
# time ./TAUscan 8 ../sudokudiag "" wdL hash "5.72,1.13,0.36,0.0001,0.02,1.1" 1000 10 all
# 1000 : 8.46197787711030823084e+06 2.46430144698034995794e+09 2.62001716718076810017e+10; 2.76804227432580180140e+09
# real    2m36.607s user    25m49.592s sys     0m4.206s
# Success in reproduction.


# laMols with newvars:

# MOLS> time ./laMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu newv asc "" 1 12 ""
# aborted after 3min wallclock-time without finding a solution.
# MOLS> time ./laMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu newv asc "" 1 12 "0,8,0,0,0,0,0,0,0"
# aborted after 9min wallclock-time without finding a solution.
# MOLS> time ./laMols 10 data/SpecsCollection/EulerSudokudiag "" +count "" enu newv ddesc "" 1 12 "0,8,0,0,0,0,0,0,0"
# aborted after 460min wallclock-time without a solution found.

# TASK OZ: Using nomad+TAUscan for finding weights for N=6,7,8,9,10.
# N=6:

# Optimising TAUscan via Nomad (MAX_TIME 600s, rep=100):
# TAU_sudokudiag_6_newv_ave> nomad np
# 558   4.468848  -1        -10         -6.000005  10          9.999999
# Blackbox evaluations: 808 Total model evaluations: 74658 Cache hits: 249 Total number of evaluations: 1057
# Reproduction:
# time ./TAUscan 6 ../sudokudiag "" newv hash "-1,-10,-6.000005,10,9.999999" 100 1 all
# 100 : 3.98036497072713720555e+00 6.17463945773979181950e+00 2.30097463187664220598e+01; 5.40108729526668134664e+00
# real    0m5.294s user    0m4.967s sys     0m0.318s
# Failure in reproduction.
# Reproduction on the full-precision weights from the log-file:
# time ./TAUscan 6 ../sudokudiag "" newv hash "-1,10,-6.0000050000048004151,10,9.9999993801000002236" 100 1 all
# 100 : 4.53670570223933163978e+00 2.15165709133775312802e+01 5.45459496195118597961e+02; 5.88265021714370999299e+01
# real    0m6.024s user    0m5.690s sys     0m0.323s
# Still failure in reproduction.

# Alternative optimisation on ave+sd (MAX_TIME 600s, rep=100):
# 639   6.4147    -0.177512   3.349368  -9.720275   4.007721  -7.894675
# Blackbox evaluations: 817 Total model evaluations: 73038 Cache hits: 283 Total number of evaluations: 1100
# Reproduction:
# time ./TAUscan 6 ../sudokudiag "" newv hash "-0.177512,3.349368,-9.720275,4.007721,-7.894675" 100 1 all
# 100 : 5.22297803152840920370e+00 1.96916257644697509938e+01 7.16214370546247748872e+02; 7.15951210311202867129e+01
# real    0m6.044s user    0m5.779s sys     0m0.254s
# Failure in reproduction.
# Reproduction on the full-precision weights from the log-file:
# time ./TAUscan 6 ../sudokudiag "" newv hash "-0.17751223667932000683,3.3493682759230400947,-9.7202753209788994582,4.0077208075690400335,-7.8946745004259701872" 100 1 all
# 100 : 4.71676218187502118567e+00 5.67231905817401228743e+00 1.17738690317435045294e+01; 1.55140314784343045205e+00
# real    0m5.399s user    0m5.065s sys     0m0.325s
# Still failure in reproduction.

# N=7:

# Optimising TAUscan via Nomad (MAX_TIME 10000s, rep=1000):
# TAU_sudokudiag_7_newv_ave> nomad np
# 376 1188.947676  -0.997257   5.000627  -1.008037  -9.999099   4.00161   -9.5205
# Blackbox evaluations: 413 Cache hits: 60 Total number of evaluations: 473
# Reproduction:
# TAU_sudokudiag_7_newv_ave> time ./TAUscan 7 ../sudokudiag "" newv hash "-0.997257,5.000627,-1.008037,-9.999099,4.00161,-9.5205" 1000 10 all
# 1000 : 2.28333305682993266350e+02 1.28073917559365581942e+03 1.04267487693232195332e+04; 1.00126587972301564050e+03
# real 2m44.360s user	11m27.661s sys	0m1.838s
# Failure in reproduction.
# TAU_sudokudiag_7_newv_ave> time ./laMols 7 ../sudokudiag "" +count dom enu newv "" "" 1 16 "-0.997257,5.000627,-1.008037,-9.999099,4.00161,-9.5205" "" ""
#  N       rt  pl lbt  dis   lbo    lar gcd     satc           t        ppc st      nds    inds      lvs     plvs
#  7   +count dom enu newv   asc  relpr   1       18     150.660     186165  0     2254    1001     1253        0
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#474.877  1.030   14.840  122.782  208.670   2.364  0.000  0.577    2.104   5.784
#334.000  0.000    0.278   60.970   71.363   1.000  0.000  0.031    0.000   0.000
#596.000  2.000   77.994  127.750  879.622   9.000  0.000  2.926   28.158  11.000
# 30.535  0.265    6.964    3.484   75.727   0.807  0.000  0.389    2.324   1.403
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#408.233  1.614   22.126   25.391   96.702   1.445  0.014  0.286   11.968   7.445
#120.000  1.100    0.000    0.000    0.477   1.000  0.000  0.000    0.477   5.000
#485.000  3.333  480.000  100.248  689.462   7.000  1.000  3.107   25.541  12.000
# 39.937  0.302   25.930   15.515   94.328   0.842  0.119  0.361    4.952   0.993
#   estlvs
# 2003.574
#  228.333
#22303.276
# 1862.074
#    mu1      w   ltau   minp  meanp   maxp    sdd     tb
#265.425  2.251  0.004  0.352  0.459  0.571  0.106  0.354
#133.000  2.000  0.001  0.062  0.250  0.263  0.000  0.026
#316.000  4.000  0.033  0.500  0.500  0.863  0.363  0.747
# 15.928  0.458  0.002  0.107  0.073  0.108  0.080  0.190
# real    0m22.198s user    2m30.670s sys     0m6.047s
# About 5 % better runtime-wise and leaves-wise than wdL.

# N=8:

# Optimising TAUscan via Nomad (MAX_TIME 72000s, rep=1000):
# TAU_sudokudiag_8_newv_ave> nomad np
# 1058 2627044713.650797   0.0126     0.0051     0.0101     0.59105    0.9438     0.0001
# Blackbox evaluations: 1197 Cache hits: 377 Total number of evaluations: 1574
# Reproduction:
# time ./TAUscan 8 ../sudokudiag "" newv hash "0.0126,0.0051,0.0101,0.59105,0.9438,0.0001" 1000 10 all
# 1000 : 5.24217234266035630426e+07 2.65492169238797818660e+09 2.86036817427294966355e+10; 3.40837561298379552970e+09
# real    4m39.637s user    38m44.672s sys     0m2.909s
# Failure in reproduction.

# Alternative optimisation on ave+sd (MAX_TIME 72000s, rep=1000):
# TAU_sudokudiag_8_newv_avepsd> nomad np
# 967 6062398371.445838   0.0001     0.0201     0.0001     0.21       0.0001     1.33
# Blackbox evaluations: 1205 Total model evaluations: 101032 Cache hits: 436 Total number of evaluations: 1641
# Reproduction:
# time ./TAUscan 8 ../sudokudiag "" newv hash "0.0001,0.0201,0.0001,0.21,0.0001,1.33" 1000 10 all
# 1000 : 9.23472943233336260382e+07 2.91823309719039523462e+09 4.59202317326371462196e+10; 3.33643219877778795315e+09
# real 2m28.504s user 24m21.975s sys 0m4.094s
# Failure in reproduction.

# Alternative optimisation on sd (MAX_TIME 10000s, rep=100):
# XXX running on server

# Alternative optimisation on max (MAX_TIME 10000s, rep=100):
# XXX running on server


squares A B aux
rred A B aux
ls A B aux
rprod B aux A
box A B
diag A B
antidiag A B
