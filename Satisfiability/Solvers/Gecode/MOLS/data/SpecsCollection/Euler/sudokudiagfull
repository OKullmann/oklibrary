# Counts for N >= 2:
# 0, 0, 0, 0, 0, 6, 1356

# Additionally to sudokudiag we have:
# diag aux, antidiag aux, box aux.
# The motivation here is to have "as much propagation as possible".

# Are these additional conditions independent?

# Question: every pair (if we don't have A=B, which is impossible)
# is enumerated twice -- how can this symmetry be broken here?


# gcMols:

# 2 <= N <= 7:

# MOLS> ./gcMols 2,7 data/SpecsCollection/Euler/sudokudiagfull "" count "" bin mindom "" 1 1 ""
#  N       rt  pl  bt        bv   bo gcd      satc           t           ppc        flvs        gnds     gd st
#  2    count dom bin    mindom  asc   1         0       0.000             4           1           0      0  0
#  3    count dom bin    mindom  asc   1         0       0.000            15           1           0      0  0
#  4    count dom bin    mindom  asc   1         0       0.000            53           1           0      0  0
#  5    count dom bin    mindom  asc   1         0       0.000            63           1           0      0  0
#  6    count dom bin    mindom  asc   1         0       0.014         62402         379         757      7  0
#  7    count dom bin    mindom  asc   1         6       2.260      10328758       56324      112659     18  0

# MOLS> ./gcMols 7 data/SpecsCollection/Euler/sudokudiagfull "" count "" - - "" 1 1 "t,2"
# best:
#  7    count dom enu maxdegdom  asc   1         6       0.715       3293114       12117       24145     15  0

# N = 8:

# MOLS> ./gcMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu maxdegdom desc 1 16 ""
#  N       rt  pl  bt        bv   bo gcd      satc           t           ppc        flvs        gnds     gd st
#  8   +count dom enu maxdegdom desc   1      1356  397586.577  497928347053  2719470620  4703027011     32  0

# As for sudokudiag:
# MOLS> ./gcMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu mindom desc 1 16 ""
# aborted, as it seems clearly producing fewer solutions than maxdegdom.



# rlaMols:

# N=7:

# MOLS> ./rlaMols 7 data/SpecsCollection/Euler/sudokudiagfull "" count dom - - - "" 1 12 "nds,5000"
#  N       rt  pl  bt        bv   bo    lar gcd     satc           t        ppc st      nds    inds      lvs
#  7    count dom bin    maxdeg  asc  relpr   1        6      52.098      91734  0      915     457      458
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#500.678  0.842    9.045  123.259  228.616   2.217  0.000  0.418    1.032   8.133
#413.000  0.000    0.427  112.774  106.769   1.000  0.000  0.026    0.000   0.000
#579.000  1.500   19.918  126.150  658.065   6.000  0.000  1.747    8.782  15.000
# 23.302  0.407    3.264    1.483   80.664   0.903  0.000  0.236    1.320   2.436
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#453.485  1.517    3.142   43.562  143.468   1.723  0.013  0.275    9.891  10.111
#363.000  1.090    0.000    0.744    1.489   1.000  0.000  0.001    0.993   5.000
#508.000  3.667   15.748  120.335  669.787   6.000  2.000  1.708   20.359  16.000
# 26.498  0.296    2.548   30.302  107.880   0.956  0.147  0.244    3.396   2.036
#  N       rt  pl  bt        bv   bo    lar gcd     satc           t        ppc st      nds    inds      lvs
#  7    count dom bin maxdegdom  asc  relpr   1        6      47.429      94522  0      925     462      463
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#489.032  0.845    9.830  123.917  221.538   2.188  0.000  0.292    0.820   7.729
#410.000  0.000    0.427  117.634  106.479   1.000  0.000  0.049    0.000   0.000
#579.000  2.000   19.918  127.073  643.656   6.000  0.000  1.088    6.754  13.000
# 25.948  0.407    3.574    1.138   78.441   0.875  0.000  0.151    0.978   2.131
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals      dp
#445.598  1.527    2.961   40.384  138.380   1.659  0.013  0.198    9.430   9.708
#303.000  1.091    0.000    0.513    1.282   1.000  0.000  0.000    1.026   6.000
#498.000  4.000   12.266  121.652  669.787   6.000  2.000  1.506   18.519  14.000
# 22.732  0.329    2.447   28.841  108.894   0.931  0.147  0.193    3.094   1.654
#  N       rt  pl  bt        bv   bo    lar gcd     satc           t        ppc st      nds    inds      lvs
#  7    count dom enu maxdegdom  asc  relpr   1        6      42.386      93269  0      864     399      465
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals     dp
#485.774  0.917   10.185  123.901  229.218   2.278  0.000  0.348    0.939  4.687
#410.000  0.000    0.427  117.634  106.479   1.000  0.000  0.052    0.000  0.000
#579.000  2.000   19.918  127.073  643.656   6.000  0.000  1.260    6.754  8.000
# 23.735  0.375    3.386    1.194   77.751   0.863  0.000  0.216    1.013  1.230
#    mu0  qfppc  pprunes  pmprune  pprobes  rounds   solc     tr  pelvals     dp
#445.914  1.528    2.944   40.370  138.448   1.660  0.013  0.219    9.437  6.331
#303.000  1.091    0.000    0.513    1.282   1.000  0.000  0.001    1.026  4.000
#498.000  4.000   12.266  121.652  669.787   6.000  2.000  1.314   18.519  9.000
# 22.760  0.329    2.431   28.607  108.598   0.931  0.146  0.209    3.121  0.834

# N=8:

# MOLS> ./rlaMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu maxdegdom "" "" 1 16 ""
# aborted after more than 11h wallclock-time:
#  N       rt  pl  bt        bv   bo    lar gcd     satc           t        ppc st      nds    inds      lvs
#  8   +count dom enu maxdegdom  asc  relpr   1        5  648582.538  904487040  1  5337665 2655297  2682368
#    mu0  qfppc  pprunes  pmprune   pprobes  rounds   solc      tr  pelvals      dp
#616.574  0.860   31.803  121.522   196.218   2.304  0.000   2.805    1.055  18.083
#458.000  0.000    0.000   94.173    58.475   1.000  0.000   0.449    0.000   0.000
#948.000  4.000  111.594  126.527  1006.587  11.000  1.000  19.009   14.125  31.000
# 43.775  0.397   13.134    2.084    79.878   0.914  0.001   1.328    1.182   2.474
#    mu0  qfppc  pprunes  pmprune   pprobes  rounds   solc      tr  pelvals      dp
#529.356  1.874    1.424   32.843    80.435   1.326  0.000   1.085    6.708  20.030
#236.000  1.026    0.000    0.000     0.434   1.000  0.000   0.000    0.434  11.000
#713.000  5.000   64.045  124.815  1044.898  11.000  2.000  21.011   25.037  32.000
# 40.836  0.420    2.841   26.776    80.590   0.680  0.001   1.209    2.853   2.120

# MOLS> time ./rlaMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu maxdegdom "" "" 1 32 "" ""
# running on server2 XXX (32 likely not efficient, but some speedup should be gained)
# started 7.9.2022, 9:59

# MOLS> time ./rlaMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu mindom "" "" 1 16 "" ""
# aborted:
#  N       rt  pl  bt        bv   bo    lar gcd     satc           t        ppc st      nds      lvs
#  8   +count dom enu    mindom  asc  relpr   1      149 5558884.136 3683388666  1 45118869 24923439
#    mu0  qfppc  pprunes  pmprune   pprobes  rounds   solc      tr  pelvals      dp
#574.671  1.000    7.735  122.468   256.193   2.454  0.000   2.457    1.755  17.736
#444.000  0.000    0.000   30.435    93.162   1.000  0.000   0.019    0.000   0.000
#948.000  3.000   42.957  129.054  1413.599  14.000  1.000  32.655   17.438  27.000
# 31.588  0.170    2.857    1.414    76.703   0.796  0.000   1.130    1.392   1.673
#    mu0  qfppc  pprunes  pmprune   pprobes  rounds   solc      tr  pelvals      dp
#525.097  1.492    3.917   34.194   148.751   1.654  0.000   1.566   10.528  19.421
# 16.000  1.020    0.000    0.000     0.371   1.000  0.000   0.000    0.371  14.000
#649.000  6.000  320.000  126.860  1334.864  13.000  2.000  38.397   27.923  28.000
# 27.363  0.206    2.420   19.743   106.485   0.934  0.003   1.263    3.375   1.349
# real    6438m23.513s user    92648m4.903s sys     1807m29.621s
# Seems less efficient than maxdegdom.


# laMols with wdL

# N=8:

# Optimising on tau-probs (MAX_TIME 30000s, rep=10000):
# sudokudiagfull_8_wdL_ave$ nomad np
# 98 52262039.513635   5.1        1.1        0.32       0.0001     0.2        0.0801
# A termination criterion is reached: Maximum allowed time reached (Base) No more points to evaluate
# Blackbox evaluations: 151 Total model evaluations: 14136 Cache hits: 7 Total number of evaluations: 158
# sudokudiagfull_8_wdL_ave$ time ./TAUscan 8 ../../sudokudiagfull "" enu wdL hash "5.1,1.1,0.32,0.0001,0.2,0.0801" 10000 10 all
# 10000 : 6.65219840175226301881e+05 5.22620395136348812339e+07 2.60748415147019011155e+09; 8.36926869526849777030e+07
# real    15m59.846s user    158m56.794s sys     0m20.880s
# MOLS$ time ./laMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu wdL "" "" 1 16 "5.1,1.1,0.32,0.0001,0.2,0.0801" "" ""
# running on server2 XXX

# Optimising on uni-probs (MAX_TIME 30000s, rep=10000):
# sudokudiagfull_8_wdL_ave$ nomad nprand
# 143 50136919.8        0.8        1.0001     0.32       0.3401     0.61       0.0001
# A termination criterion is reached: Maximum allowed time reached (Base) No more points to evaluate
# Blackbox evaluations: 167 Total model evaluations: 14155 Cache hits: 7 Total number of evaluations: 174
# sudokudiagfull_8_wdL_ave$ time ./TAUscan 8 ../../sudokudiagfull "" enu,rand wdL hash "0.8,1.0001,0.32,0.3401,0.61,0.0001" 10000 10 all
# 10000 : 1.29600000000000000000e+05 5.01369197999999999993e+07 5.66231040000000000000e+09; 1.21308330606101161837e+08
# real    14m31.253s user    143m53.732s sys     0m20.317s
# MOLS$ time ./laMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu wdL "" "" 1 16 "0.8,1.0001,0.32,0.3401,0.61,0.0001" "" ""
# running on server XXX



# laMols with newvars

# N=8:

# Optimising TAUscan via Nomad (MAX_TIME 20000s, rep=1000):
# sudokudiagfull_8_newv_ave$ nomad np
# aborted:
# 110  14222535.081796  -0.01      10        -10         -3         -8         10         10
# Restarted with MAX_TIME 30000s, rep=10000:
# sudokudiagfull_8_newv_ave$ nomad np2
# 161 20731045.589498  -0.88       8.77      -9.81      -2.91      -7.8        9.94      -9
# A termination criterion is reached: Maximum allowed time reached (Base) Success found and opportunistic strategy is used
# Blackbox evaluations: 168 Total model evaluations: 13140 Cache hits: 19 Total number of evaluations: 187
# sudokudiagfull_8_newv_ave$ time ./TAUscan 8 ../../sudokudiagfull "" enu newv hash "-0.88,8.77,-9.81,-2.91,-7.8,9.94,-9" 10000 10 all
# 10000 : 1.05081945798690160334e+04 2.07310455894979902441e+07 1.49216512955721320156e+10; 2.16453972836088309879e+08
# real    15m57.622s user    158m25.155s sys     0m19.033s
# sudokudiagfull_8_newv_ave$ time ./laMols 8 ../../sudokudiagfull "" +count dom enu newv "" "" 1 16 "-0.88,8.77,-9.81,-2.91,-7.8,9.94,-9" "" ""
#  N       rt  pl lbt  dis   lbo    lar gcd     satc           t        ppc st      nds    inds      lvs     plvs
#  8   +count dom enu newv   asc  relpr   1     1356 14586191.149 15436707053  0 105236668 37673336 67563332        0
#    mu0  qfppc   pprunes  pmprune   pprobes  rounds   solc      tr  pelvals      dp
#603.058  0.938    11.947  123.342   240.545   2.418  0.000   2.457    1.252  13.162
# 32.000  0.000     0.000   22.652    10.000   1.000  0.000   0.000    0.000   0.000
#948.000  4.000  1700.000  200.000  1537.859  15.000  1.000  57.881   17.603  23.000
# 47.985  0.332     5.452    2.101    89.393   0.940  0.001   1.191    1.280   1.721
#    mu0  qfppc  pprunes  pmprune   pprobes  rounds   solc      tr  pelvals      dp
#533.100  1.602    3.325   32.910   115.359   1.474  0.000   1.239    8.257  14.628
# 16.000  1.014    0.000    0.000     0.300   1.000  0.000   0.000    0.300   8.000
#741.000  7.000  173.333  128.992  1535.511  15.000  3.000  47.233   27.957  24.000
# 51.463  0.411    2.652   26.864   102.769   0.856  0.006   1.216    3.541   1.480
#       estlvs
#3.321028e+473
# 1.050819e+04
#5.609493e+480
#1.364891e+477
#    mu1      w      ltau   minp  meanp   maxp    sdd      tb
#336.678  2.793     0.004  0.269  0.398  0.552  0.128   1.346
# 32.000  2.000     0.000  0.000  0.143  0.143  0.000   0.000
#458.000  7.000  4676.565  0.500  0.500  1.000  0.500  19.466
# 17.553  0.988     2.218  0.161  0.117  0.146  0.098   0.393
# real    17182m30.284s user    243103m11.160s sys     9976m22.049s
# Reasonably close to the prediction.

# Rerunning with new version >= 0.99:

# Optimisation on tau-probs (30000s, rep=10000):
# TAU/sudokudiagfull_8_newv_ave$ nomad np3
# 51 43940955.892803   0.04       8         -9          6         -8         10         10
# A termination criterion is reached: Maximum allowed time reached (Base) No more points to evaluate
# Blackbox evaluations: 140 Total model evaluations: 12148 Cache hits: 9 Total number of evaluations: 149
# sudokudiagfull_8_newv_ave$ time ./TAUscan 8 ../../sudokudiagfull "" enu newv hash "0.04,8,-9,6,-8,10,10" 10000 10 all
# 10000 : 4.98015430554990121550e+05 4.39409558928033900593e+07 3.22267801544539605547e+09; 8.24790264012769165347e+07
# real    17m16.346s user    171m34.361s sys     0m20.906s
# MOLS> time ./laMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu newv "" "" 1 16 "0.04,8,-9,6,-8,10,10" "" ""
#  N       rt  pl lbt  dis   lbo    lar gcd     satc           t        ppc st      nds      lvs          nsel         nsuel
#  8   +count dom enu newv   asc  relpr   1     1356 9110455.219 10274641589  0 74727811 44725294  2.612179e+00  2.262952e+00
#   mu0    qfppc  pprunes  pmprune  pprobes   rounds        solc       tr  pelvals      dp
#560.52  0.92263   9.2973   124.92    240.2   2.3069  1.3332e-06   2.0463   1.0886  13.487
#    32        0        0   27.246   3.2934        1           0  8.9e-05        0       0
#   948        4     1700      200   1559.9       15           1   16.293   18.147      20
#  48.3    0.367   4.3006   1.8968   86.052  0.88138   0.0011547  0.89496   1.0771  1.7065
#   mu0    qfppc  pprunes  pmprune  pprobes   rounds        solc      tr  pelvals      dp
#493.94   1.5706   3.0282   39.871    122.7    1.472  2.9424e-05  1.1183    7.587  15.241
#    16   1.0133        0        0  0.33058        1           0       0  0.33058       8
#   716        7      100   130.09   1404.5       14           3  18.237   29.048      21
#39.839  0.42494    2.568   31.039   103.87  0.83915    0.006667  1.0057   3.3086   1.313
#      estlvs       uestlvs
#3.499074e+08  2.737613e+08
#3.474443e+05  1.800000e+05
#5.988618e+14  2.612736e+11
#1.794935e+11  9.996202e+08
#   dm0        w  ltausp        minp     meanp     maxp       sdd        tb
#6.4668   2.4907  14.862      0.3329   0.43078  0.54017  0.095289    1.1074
#     0        2       1  3.0393e-08   0.14286  0.15877         0  0.003507
#   484        7  1229.2         0.5       0.5  0.99674   0.49674    3.1193
#7.1368  0.74929  24.865     0.14277  0.099033  0.11047  0.079695   0.22683
# real    9699m6.318s user    151840m55.228s sys     1791m25.693s
# Better than before, and nearly exactly matching the prediction.
# Optimisation with rep=1000: XXX

# Optimising on ave+sd:
# TAU/sudokudiagfull_8_newv_avepsd$ nomad np
# 62  97459792.502697   0         -3          4         -1         -8          9         -8
# A termination criterion is reached: Maximum allowed time reached (Base) No more points to evaluate
# Blackbox evaluations: 143 Total model evaluations: 12147 Cache hits: 7 Total number of evaluations: 150
# TAU/sudokudiagfull_8_newv_avepsd$ time ./TAUscan 8 ../../sudokudiagfull "" enu newv hash "0,-3,4,-1,-8,9,-8" 10000 10 all
# 10000 : 8.53875718336112910208e+05 4.22981674242427935460e+07 1.22359599208937499300e+09; 5.51616250784542411566e+07
# real    17m34.461s user    174m18.258s sys     0m20.985s
# MOLS> time ./laMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu newv "" "" 1 16 "0,-3,4,-1,-8,9,-8" "" ""
# running on server2 XXX

# Optimisation on uni-probs (30000s, rep=10000):
# TAU/sudokudiagfull_8_newv_ave$ nomad np3rand
# 96 41718972.435     -0.59       3          5         -1         -8          9         -9
# A termination criterion is reached: Maximum allowed time reached (Base) No more points to evaluate
# Blackbox evaluations: 152 Total model evaluations: 14177 Cache hits: 10 Total number of evaluations: 162
# sudokudiagfull_8_newv_ave$ time ./TAUscan 8 ../../sudokudiagfull "" enu,rand newv hash "-0.59,3,5,-1,-8,9,-9" 10000 10 all
# 10000 : 5.40000000000000000000e+05 4.17189724350000000013e+07 1.57464000000000000000e+09; 6.88188593080104786350e+07
# real    16m51.033s user    167m9.914s sys     0m20.936s
# MOLS> time ./laMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu newv "" "" 1 16 "-0.59,3,5,-1,-8,9,-9" "" ""
# running on server XXX

# Optimising on ave+sd:
# TAU/sudokudiagfull_8_newv_avepsd$ nomad nprand
# running server2 XXX
# TAU/sudokudiagfull_8_newv_avepsd$ time ./TAUscan 8 ../../sudokudiagfull "" enu,rand newv hash "XXX" 10000 10 all
# 127  99750606.009699  -0.64      -1         -3         -1         -5          8         -2
# A termination criterion is reached: Maximum allowed time reached (Base) No more points to evaluate
# Blackbox evaluations: 152 Total model evaluations: 12139 Cache hits: 4 Total number of evaluations: 156
# sudokudiagfull_8_newv_avepsd$ time ./TAUscan 8 ../../sudokudiagfull "" enu,rand newv hash "-0.64,-1,-3,-1,-5,8,-2" 10000 10 all
# 10000 : 3.24000000000000000000e+05 3.99461783400000000001e+07 1.03680000000000000000e+09; 5.98044276696989289849e+07
# real    16m45.640s user    166m25.579s sys     0m20.467s
# MOLS> time ./laMols 8 data/SpecsCollection/Euler/sudokudiagfull "" +count dom enu newv "" "" 1 16 "-0.64,-1,-3,-1,-5,8,-2" "" ""
# running on server XXX



squares A B aux
rred A B aux
ls A B aux
rprod A aux B
diag A B aux
antidiag A B aux
box A B aux
